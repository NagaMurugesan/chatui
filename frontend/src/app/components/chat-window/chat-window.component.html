<div class="flex h-screen bg-white overflow-hidden">
    <!-- Sidebar -->
    <app-sidebar [chats]="chats" [selectedChatId]="selectedChatId" (chatSelected)="selectChat($event)"
        (newChat)="createNewChat()" (deleteChat)="deleteChat($event)" (renameChat)="renameChat($event)"
        (logout)="logout()">
    </app-sidebar>

    <!-- Main Chat Area -->
    <div class="flex-1 flex flex-col h-full relative">
        <!-- Header -->
        <div class="bg-white border-b border-gray-200 p-4 flex justify-between items-center">
            <div class="flex-1">
                <h1 class="text-lg font-semibold text-gray-700">Gravity Chat</h1>
            </div>
            <div class="flex items-center gap-4">
                <!-- Model Selector -->
                <div class="flex items-center gap-2">
                    <label class="text-sm font-medium text-gray-700">Model:</label>
                    <select [(ngModel)]="selectedModel"
                        class="text-sm border border-gray-300 rounded px-3 py-1.5 focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                        <option *ngFor="let model of availableModels" [value]="model.value">
                            {{ model.label }}
                        </option>
                    </select>
                </div>
                <div class="text-sm text-gray-500" *ngIf="userName">
                    Logged in as: <span class="font-medium text-gray-800">{{ userName }}</span>
                </div>
            </div>
        </div>

        <!-- Messages -->
        <div class="flex-1 overflow-y-auto p-4 pb-32" #scrollContainer>
            <div class="max-w-3xl mx-auto w-full">
                <app-message-bubble *ngFor="let msg of messages" [message]="msg"></app-message-bubble>

                <div *ngIf="isLoading" class="flex justify-start w-full mb-6">
                    <div class="bg-gray-100 text-gray-800 rounded-lg px-4 py-3">
                        <span class="animate-pulse">Thinking...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Input Area -->
        <div class="absolute bottom-0 left-0 w-full bg-white border-t border-gray-200 p-4">
            <div class="max-w-3xl mx-auto w-full relative">
                <textarea [(ngModel)]="newMessage" (keydown.enter)="$event.preventDefault(); sendMessage()"
                    placeholder="Send a message..."
                    class="w-full border border-gray-300 rounded-lg pl-4 pr-12 py-3 focus:outline-none focus:border-blue-500 resize-none shadow-sm"
                    rows="1" style="min-height: 52px; max-height: 200px;">
        </textarea>
                <button (click)="sendMessage()" [disabled]="!newMessage.trim() || isLoading"
                    class="absolute right-3 bottom-3 text-blue-500 hover:text-blue-700 disabled:text-gray-300 p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                        <path
                            d="M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z" />
                    </svg>
                </button>
            </div>
            <div class="text-center text-xs text-gray-400 mt-2">
                ChatGPT can make mistakes. Consider checking important information.
            </div>
        </div>
    </div>
</div>